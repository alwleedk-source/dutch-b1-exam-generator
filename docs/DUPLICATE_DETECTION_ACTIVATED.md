# ุชูุนูู ูุธุงู ูุดู ุงูุชุดุงุจู - 80% Threshold

## ููุฎุต ุงูุชุญุฏูุซ

ุชู ุจูุฌุงุญ **ุชูุนูู ูุธุงู ูุดู ุงูุชุดุงุจู** ุงูุฐู ูุงู ููุฌูุฏุงู ููู ุบูุฑ ูุณุชุฎุฏูุ ูุน ุชุนุฏูู ุนุชุจุฉ ุงูุชุดุงุจู ุฅูู **80%** ููุง ุทูุจุช.

---

## ุงูุชุบููุฑุงุช ุงููููุฐุฉ

### 1. ุชุนุฏูู ุนุชุจุฉ ุงูุชุดุงุจู

**ุงูููู:** `server/lib/minhash.ts`

**ูุจู:** 95% similarity threshold
```typescript
const similarTexts = findSimilarTexts(signature, existingTexts, 0.95);
```

**ุจุนุฏ:** 80% similarity threshold
```typescript
const similarTexts = findSimilarTexts(signature, existingTexts, 0.80);
```

**ุงููุนูู:**
- ุฃู ูุต ูุดุงุจู ุจูุณุจุฉ **80% ุฃู ุฃูุซุฑ** ุณูุชู ุฑูุถู
- ูุฌุจ ุฃู ูููู ุงููุต ูุฎุชููุงู ุจูุณุจุฉ **20% ุนูู ุงูุฃูู** ุนู ุงููุตูุต ุงูููุฌูุฏุฉ
- ุงูุชุดุงุจู ููุญุณุจ ุจูุงุกู ุนูู **ุงููููุงุช ุงููุชุดุงุจูุฉ** ูู ุงููุตูุต (word n-grams)

---

### 2. ุชูุนูู ุงููุญุต ูู ุนูููุฉ ุงูุฅูุดุงุก

**ุงูููู:** `server/routers.ts` - `text.create` endpoint

**ุชู ุฅุถุงูุฉ ูุญุต ุงูุชุดุงุจู ูู ุงูููุงู ุงูุตุญูุญ:**

```typescript
// ุชุฑุชูุจ ุงููุญูุตุงุช:
1. ุงูุชุญูู ูู ุงูุญุฏ ุงููููู (3 ูุตูุต/ููู)
2. ุงูุชุญูู ูู ุงููุบุฉ ุงูููููุฏูุฉ โ
3. ูุญุต ุงูุชุดุงุจู (ุฌุฏูุฏ) โ โ ุชู ุฅุถุงูุชู ููุง
4. ูุนุงูุฌุฉ ุงููุต ุจู Gemini
5. ุญูุธ ุงููุต ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

**ุงูููุฏ ุงููุถุงู:**
```typescript
// โ Check for duplicate texts (80% similarity threshold)
console.log('[Text Creation] Checking for duplicate texts...');
const { checkDuplicate } = await import("./lib/minhash");

// Get all existing texts with their signatures
const allTexts = await db.getAllTexts();
const textsWithSignatures = allTexts
  .filter(t => t.min_hash_signature)
  .map(t => ({
    id: t.id,
    title: t.title || `Text #${t.id}`,
    signature: JSON.parse(t.min_hash_signature!),
  }));

// Check for duplicates
const duplicateCheck = checkDuplicate(input.dutch_text, textsWithSignatures);

if (duplicateCheck.isDuplicate) {
  const similarTextsInfo = duplicateCheck.similarTexts
    .map(t => `"${t.title}" (${Math.round(t.similarity * 100)}% similar)`)
    .join(', ');
  
  throw new TRPCError({
    code: "BAD_REQUEST",
    message: `This text is too similar to existing text(s): ${similarTextsInfo}. Please use original content with at least 20% difference.`,
  });
}
console.log('[Text Creation] โ Duplicate check passed: Text is original');
```

---

### 3. ุชุญุณูู ุงูุฃุฏุงุก

**ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุชูููุน ุงูุฑููู:**
```typescript
// ูุจู: ูุงู ูุญุณุจ ุงูุชูููุน ูุฑุชูู
const minHashSignature = calculateMinHash(cleanedText);

// ุจุนุฏ: ูุนูุฏ ุงุณุชุฎุฏุงู ุงูุชูููุน ูู ูุญุต ุงูุชุดุงุจู
const minHashSignature = duplicateCheck.signature;
```

**ุงููุงุฆุฏุฉ:**
- ุชูููุฑ ููุงุฑุฏ ุงููุนุงูุฌุฉ
- ุชุณุฑูุน ุนูููุฉ ุงูุฅูุดุงุก
- ุชุฌูุจ ุงูุญุณุงุจุงุช ุงูููุฑุฑุฉ

---

## ููู ูุนูู ุงููุธุงู

### ุฎูุงุฑุฒููุฉ MinHash

**1. ุชูุณูู ุงููุต ุฅูู Shingles (Word N-grams):**
```
ุงููุต: "De kat zit op de mat"
Shingles (5 ูููุงุช):
- "de kat zit op de"
- "kat zit op de mat"
```

**2. ุญุณุงุจ ุงูุชูููุน ุงูุฑููู:**
- ุงุณุชุฎุฏุงู 128 hash function ูุฎุชููุฉ
- ูู shingle ููุญุณุจ hash ูู
- ุงููุชูุฌุฉ: array ูู 128 ุฑูู (ุงูุชูููุน ุงูุฑููู)

**3. ููุงุฑูุฉ ุงูุชูุงููุน:**
```
ุงูุชูููุน 1: [123, 456, 789, ...]
ุงูุชูููุน 2: [123, 999, 789, ...]
ุงูุชุดุงุจู = ุนุฏุฏ ุงูุฃุฑูุงู ุงููุชุทุงุจูุฉ / 128
```

**4. ุงููุฑุงุฑ:**
```
ุฅุฐุง ูุงู ุงูุชุดุงุจู >= 80%:
  โ ุฑูุถ ุงููุต
ูุฅูุง:
  โ ูุจูู ุงููุต
```

---

## ุฃูุซูุฉ ุนูู ุงูุณููุงุฑูููุงุช

### ุณููุงุฑูู 1: ูุต ููุฑุฑ ุชูุงูุงู
```
ุงููุต ุงูููุฌูุฏ: "De kat zit op de mat..."
ุงููุต ุงูุฌุฏูุฏ: "De kat zit op de mat..." (ููุณ ุงููุต)
ุงูุชุดุงุจู: 100%
ุงููุชูุฌุฉ: โ ูุฑููุถ
ุงูุฑุณุงูุฉ: "This text is too similar to existing text(s): 'Example' (100% similar)"
```

### ุณููุงุฑูู 2: ูุต ูุดุงุจู ุฌุฏุงู
```
ุงููุต ุงูููุฌูุฏ: "De kat zit op de mat en speelt met de bal..."
ุงููุต ุงูุฌุฏูุฏ: "De kat zit op de mat en speelt met de muis..." (ุชุบููุฑ ุจุณูุท)
ุงูุชุดุงุจู: ~85%
ุงููุชูุฌุฉ: โ ูุฑููุถ
ุงูุฑุณุงูุฉ: "This text is too similar to existing text(s): 'Example' (85% similar)"
```

### ุณููุงุฑูู 3: ูุต ูุฎุชูู ุจุดูู ูุนููู
```
ุงููุต ุงูููุฌูุฏ: "De kat zit op de mat..."
ุงููุต ุงูุฌุฏูุฏ: "De hond rent in de tuin..." (ููุถูุน ูุฎุชูู)
ุงูุชุดุงุจู: ~30%
ุงููุชูุฌุฉ: โ ููุจูู
```

### ุณููุงุฑูู 4: ูุต ูุฎุชูู ุชูุงูุงู
```
ุงููุต ุงูููุฌูุฏ: "De kat zit op de mat..."
ุงููุต ุงูุฌุฏูุฏ: "Het weer is vandaag mooi..." (ููุถูุน ูุฎุชูู ุชูุงูุงู)
ุงูุชุดุงุจู: ~5%
ุงููุชูุฌุฉ: โ ููุจูู
```

---

## ุงูููุงุฆุฏ

### 1. ููุน ุงููุญุชูู ุงูููุฑุฑ โ
- ูุถูู ุฃู ูู ูุต ูุฑูุฏ
- ูุญุงูุธ ุนูู ุฌูุฏุฉ ุงููุญุชูู
- ูุดุฌุน ุนูู ุงูุฅุจุฏุงุน

### 2. ุชูููุฑ ุชูุงููู API โ
- ุงููุญุต ูุญุฏุซ **ูุจู** ุฅุฑุณุงู ุงููุต ุฅูู Gemini
- ุฅุฐุง ูุงู ุงููุต ููุฑุฑุงูุ ูุง ูุชู ุงุณุชููุงู API
- ุชูููุฑ ูุจูุฑ ูู ุงูุชูุงููู

### 3. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู โ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- ุนุฑุถ ุงููุตูุต ุงููุดุงุจูุฉ
- ุชูุถูุญ ูุณุจุฉ ุงูุชุดุงุจู
- ุฅุฑุดุงุฏุงุช ูุงุถุญุฉ (20% difference required)

### 4. ุญูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช โ
- ููุน ุชุถุฎู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุตูุต ููุฑุฑุฉ
- ุงูุญูุงุธ ุนูู ูุธุงูุฉ ุงูุจูุงูุงุช
- ุณูููุฉ ุงูุฅุฏุงุฑุฉ

---

## ุฑุณุงุฆู ุงูุฎุทุฃ

### ุฑุณุงูุฉ ุงูุชุดุงุจู
```
This text is too similar to existing text(s): "Example Text" (85% similar). 
Please use original content with at least 20% difference.
```

**ุงููุนูููุงุช ุงูููุฏูุฉ:**
- โ ุนููุงู ุงููุต ุงููุดุงุจู
- โ ูุณุจุฉ ุงูุชุดุงุจู ุจุงูุถุจุท
- โ ุงูุญุฏ ุงููุทููุจ (20% difference)
- โ ุฅุฑุดุงุฏุงุช ูุงุถุญุฉ

### ุฅุฐุง ูุงู ููุงู ุนุฏุฉ ูุตูุต ูุดุงุจูุฉ
```
This text is too similar to existing text(s): "Text 1" (85% similar), "Text 2" (82% similar). 
Please use original content with at least 20% difference.
```

---

## ุงูุฃูุธูุฉ ุงูุฃุฎุฑู ุงูููุฌูุฏุฉ

### 1. ุญุฏูุฏ ุงูุฃุญุฑู โ
```
ุงูุญุฏ ุงูุฃุฏูู: 2000 ุญุฑู (~400 ูููุฉ)
ุงูุญุฏ ุงูุฃูุตู: 10,100 ุญุฑู (~2020 ูููุฉ)
```

### 2. ุงูุชุญูู ูู ุงููุบุฉ โ
```
ูุฑูุถ ุฃู ูุต ุบูุฑ ููููุฏู
```

### 3. ุงูุญุฏ ุงููููู โ
```
3 ูุตูุต ููุท ููููุงู ูููุณุชุฎุฏููู ุงูุนุงุฏููู
ุบูุฑ ูุญุฏูุฏ ููุฃุฏูู
```

### 4. ูุธุงู ุงูุฃุณุฆูุฉ ุงูุฏููุงูููู โ
```
6-15 ุณุคุงู ุญุณุจ ุทูู ุงููุต
ุญุณุงุจ ุชููุงุฆู ูููุช ุงูุงูุชุญุงู
```

---

## ุชุณูุณู ุงูุญูุงูุฉ ุงููุงูู

```
1. ุงููุณุชุฎุฏู ูุฑุณู ูุต ุฌุฏูุฏ
   โ
2. ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎู (protectedProcedure)
   โ
3. ุงูุชุญูู ูู ุทูู ุงููุต (2000-10100 ุญุฑู)
   โ
4. ุงูุชุญูู ูู ุงูุญุฏ ุงููููู (3 ูุตูุต/ููู)
   โ
5. ุงูุชุญูู ูู ุงููุบุฉ ุงูููููุฏูุฉ โ
   โ
6. ูุญุต ุงูุชุดุงุจู (80% threshold) โ ุฌุฏูุฏ
   โ
7. ูุนุงูุฌุฉ ุงููุต ุจู Gemini
   โ
8. ุญุณุงุจ ุนุฏุฏ ุงูุฃุณุฆูุฉ ูููุช ุงูุงูุชุญุงู
   โ
9. ุชูุณูู ุงููุต (AI-powered)
   โ
10. ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงูุชูููุน ุงูุฑููู
   โ
11. ุฅูุดุงุก ุงูุฃุณุฆูุฉ ูุงูููุฑุฏุงุช
   โ
12. โ ูุฌุงุญ
```

---

## ุงูุฅุญุตุงุฆูุงุช ูุงููุฑุงูุจุฉ

### Console Logs ุงููุถุงูุฉ
```typescript
console.log('[Text Creation] Checking for duplicate texts...');
// ... ูุญุต ุงูุชุดุงุจู
console.log('[Text Creation] โ Duplicate check passed: Text is original');
```

**ูููู ูุชุงุจุนุฉ:**
- ุนุฏุฏ ุงููุตูุต ุงููุฑููุถุฉ ุจุณุจุจ ุงูุชุดุงุจู
- ุงููุตูุต ุงููุดุงุจูุฉ ุงูุฃูุซุฑ ุดููุนุงู
- ูุณุจ ุงูุชุดุงุจู ุงููุชูุณุทุฉ

---

## ุงูุชูุตูุงุช ุงููุณุชูุจููุฉ

### 1. ูุงุฌูุฉ ูุณุชุฎุฏู ููุญุต ุงูุชุดุงุจู
- ุฒุฑ "Check for Duplicates" ูุจู ุงูุฅุฑุณุงู
- ุนุฑุถ ุงููุตูุต ุงููุดุงุจูุฉ ูุจุงุดุฑุฉ
- ุชุญุฐูุฑ ุงููุณุชุฎุฏู ูุจู ุงูุฅุฑุณุงู

### 2. ุฅุญุตุงุฆูุงุช ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- ุนุฏุฏ ุงููุตูุต ุงููุฑููุถุฉ ุจุณุจุจ ุงูุชุดุงุจู
- ุงููุตูุต ุงูุฃูุซุฑ ุชูุฑุงุฑุงู
- ุฑุณูู ุจูุงููุฉ ููุชุดุงุจู

### 3. ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ
- ุงูุชุฑุงุญุงุช ูุชุนุฏูู ุงููุต
- ุนุฑุถ ุงูุฃุฌุฒุงุก ุงููุชุดุงุจูุฉ
- ุฃูุซูุฉ ุนูู ุงูุชุนุฏููุงุช ุงูููุจููุฉ

---

## ุงูุฎูุงุตุฉ

โ **ุชู ุจูุฌุงุญ ุชูุนูู ูุธุงู ูุดู ุงูุชุดุงุจู ุจุนุชุจุฉ 80%**

**ุงููุชูุฌุฉ:**
- ุญูุงูุฉ ูููุฉ ุถุฏ ุงููุญุชูู ุงูููุฑุฑ
- ุชูููุฑ ุชูุงููู API
- ุชุญุณูู ุฌูุฏุฉ ุงููุญุชูู
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู

**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุฅูุชุงุฌ โ

**ุฑูู ุงูู Commit:** `f664042`

**ุงููุณุชูุฏุน:** https://github.com/alwleedk-source/dutch-b1-exam-generator

---

**ุชู ุชูููุฐ ุฌููุน ุงููุชุทูุจุงุช ุจูุฌุงุญ!** ๐
