# تحديثات Dutch B1 Exam Generator 2.0

## التحديثات الأخيرة (20 نوفمبر 2024)

### 1. تحديث حدود النصوص المقبولة

بناءً على تحليل الامتحانات الرسمية لـ Staatsexamen NT2 Lezen I 2022، تم تحديث حدود النصوص لتتناسب مع معايير الامتحان الحقيقي:

*   **الحد الأدنى**: 2500 حرف (بدلاً من 50 حرفاً)
*   **الحد الأقصى**: 6000 حرف (كما كان)

**السبب**: معظم النصوص في الامتحان الرسمي تتراوح بين 5000-6000 حرف، وهذا الطول ضروري لتوليد أسئلة متنوعة وعالية الجودة.

### 2. محرك توليد الأسئلة الذكي

تم تطوير محرك جديد يحاكي بدقة أسلوب الأسئلة في Staatsexamen:

*   **توزيع متوازن**: 20% فكرة رئيسية، 30% بحث، 10% تسلسل، 15% استنتاج، 25% مفردات
*   **صياغة احترافية**: استخدام التعابير الرسمية مثل "volgens de tekst", "In welke volgorde"
*   **خيارات مضللة واقعية**: تبدو منطقية لكنها ليست الإجابة الأدقة
*   **3 مستويات صعوبة**: سهل (40%)، متوسط (40%)، صعب (20%)

### 3. نظام تنسيق النصوص التلقائي

*   **اكتشاف تلقائي** لنوع النص (صحيفة، مقالة، تعليمات، قائمة، عادي)
*   **تنسيق عمودين** للنصوص الصحفية (مثل الامتحان الرسمي)
*   **تنسيق القوائم** المرقمة والنقطية
*   **حفظ HTML** المنسق في قاعدة البيانات

### 4. نظام الترجمة التفاعلية

*   **استخراج ذكي** لأهم 20 كلمة (B1 level)
*   **ترجمة إلى 4 لغات**: عربي، إنجليزي، تركي، هولندي (مع تعريف)
*   **تصنيف الكلمات**: حسب النوع (اسم، فعل، صفة) والصعوبة

### 5. لوحة تحليل الأداء الذكية

*   **Score رسمي**: تحويل النقاط إلى Score (276-740) باستخدام الجدول الرسمي
*   **تحليل حسب النوع**: أداء الطالب في كل نوع من الأسئلة
*   **توصيات ذكية**: نصائح مخصصة بالهولندية للتحسين

## الملفات المضافة

*   `server/lib/scoring.ts`: منطق حساب Score وتحليل الأداء
*   `server/lib/text-formatter.ts`: منطق تنسيق النصوص التلقائي
*   `add_new_features.sql`: ملف migration لقاعدة البيانات

## الملفات المحدثة

*   `server/lib/gemini.ts`: تحديث prompts توليد الأسئلة واستخراج المفردات
*   `server/lib/ocr.ts`: تحديث حد الأحرف الأدنى إلى 2500
*   `server/routers.ts`: تكامل الميزات الجديدة + تحديث validation
*   `drizzle/schema.ts`: إضافة حقول جديدة للجداول

## التغييرات في قاعدة البيانات

```sql
-- جدول texts
ALTER TABLE texts ADD COLUMN formatted_html TEXT;
ALTER TABLE texts ADD COLUMN text_type VARCHAR(50);

-- جدول exams
ALTER TABLE exams ADD COLUMN staatsexamen_score INTEGER;

-- جدول vocabulary
ALTER TABLE vocabulary ADD COLUMN dutchDefinition TEXT;
ALTER TABLE vocabulary ADD COLUMN wordType VARCHAR(50);
```

## الخطوات التالية (Frontend)

لاستكمال التطوير، يجب تحديث الواجهة الأمامية:

1.  **عرض النص المنسق**: استخدام `formatted_html` بدلاً من النص العادي
2.  **الترجمة التفاعلية**: إضافة tooltips عند hover وحفظ عند double-click
3.  **صفحة النتائج**: عرض `staatsexamen_score` ورسم بياني للأداء والتوصيات

## مثال على نص من الامتحان الرسمي

تم حفظ نص حقيقي من امتحان 2022 في `/home/ubuntu/test_text.txt` (5067 حرفاً) لاستخدامه في الاختبار.

---

**ملاحظة**: جميع التحديثات مبنية على تحليل دقيق لامتحان Staatsexamen NT2 Lezen I 2022 الرسمي.
