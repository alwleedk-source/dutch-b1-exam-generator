# Unified Text Cleaning - ุญู ููุญุฏ ูุชูุธูู ุงููุตูุต

## ๐ฏ ุงููุดููุฉ ุงูุชู ุชู ุญููุง

**ูุจู:**
- โ ุชูุธูู OCR ูู ููุงู
- โ ุชูุธูู ุงููุณุฎ/ุงููุตู ูู ููุงู ุขุฎุฑ  
- โ ูุง ุชูุธูู ูููุต ุงููุฏูู
- โ ุญููู ูุชุนุฏุฏุฉ ููุนูุฏุฉ

**ุจุนุฏ:**
- โ **ุญู ูุงุญุฏ ููุญุฏ** ูุนูู ูู **ุฌููุน ุงูุญุงูุงุช**
- โ **Gemini ููุฑุฑ** ูุง ูุญุชุงุฌ ุฅุตูุงุญ
- โ **ููุงู ูุงุญุฏ** ููุชูุธูู (text.create mutation)
- โ **ุจุณูุท ููุนุงู**

---

## ๐๏ธ ุงูุจููุฉ ุงูุฌุฏูุฏุฉ

### 1. ุฏุงูุฉ ููุญุฏุฉ: `cleanAndFormatText` ูู `server/lib/gemini.ts`

```typescript
/**
 * Clean, correct, and format any Dutch text using Gemini AI
 * Works for OCR text, pasted text, or manually typed text
 * Gemini analyzes the text and decides what needs to be fixed
 */
export async function cleanAndFormatText(text: string): Promise<string>
```

**ุงููููุฒุงุช:**
- โ ุชุนูู ูุน **ุฃู ูุตุฏุฑ ูุต** (OCR / ูุณุฎ / ูุฏูู)
- โ **Gemini ูุญูู** ุงููุต ูููุฑุฑ ูุง ูุญุชุงุฌ ุฅุตูุงุญ
- โ **ุฐููุฉ** - ูุง ุชุบูุฑ ุงููุต ุฅุฐุง ูุงู ุตุญูุญ
- โ **ุดุงููุฉ** - ุชุตูุญ ุฌููุน ุฃููุงุน ุงูุฃุฎุทุงุก

**ูุง ูุตูุญู Gemini:**

#### 1. ุฃุฎุทุงุก OCR:
- โ ุฑููุฒ ุบุฑูุจุฉ: `|`, `\\`, `ยฃ`, `*`, `+`, `<`, `>`, `{`, `}`, `[`, `]`, `~`
- โ ุญุฑูู ุฎุงุทุฆุฉ: `rn` โ `m`, `l` โ `I`
- โ ูุณุงูุงุช ููููุฏุฉ ุฃู ุฒุงุฆุฏุฉ
- โ ุฌูู ูุชุฏุงุฎูุฉ

#### 2. ุฃุฎุทุงุก ุฅููุงุฆูุฉ ููุญููุฉ:
- โ ุฃุฎุทุงุก ูุชุงุจุฉ
- โ ุฃูุนุงู ุฎุงุทุฆุฉ
- โ ุนูุงูุงุช ุชุฑููู ููููุฏุฉ ุฃู ุฎุงุทุฆุฉ

#### 3. ุชูุณูู ูุจููุฉ:
- โ ููุฑุงุช ุชุญุชุงุฌ ูุตู
- โ ุฌูู ุทูููุฉ ุฃู ุบูุฑ ูุงุถุญุฉ
- โ ุญุฑูู ูุจูุฑุฉ ููููุฏุฉ

---

### 2. ููุทุฉ ุชูููุฐ ูุงุญุฏุฉ: `text.create` mutation ูู `server/routers.ts`

```typescript
// โจ STEP 1: Clean and format text with Gemini AI (works for ALL input sources)
console.log('[Text Creation] Cleaning and formatting text with Gemini AI...');
let cleanedText = input.dutch_text;
try {
  cleanedText = await gemini.cleanAndFormatText(input.dutch_text);
  console.log('[Text Creation] Text cleaned successfully');
} catch (error) {
  console.error('[Text Creation] Failed to clean text with Gemini:', error);
  // Continue with original text if cleaning fails
  cleanedText = input.dutch_text;
}

// ุฌููุน ุงูุนูููุงุช ุงูุชุงููุฉ ุชุณุชุฎุฏู cleanedText:
// - ุญุณุงุจ ุนุฏุฏ ุงููููุงุช
// - ูุดู ุงูุชูุฑุงุฑ
// - ุงูุชูุณูู
// - ุชูููุฏ ุงูุนููุงู
// - ุชูููุฏ ุงูุฃุณุฆูุฉ
// - ุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช
// - ุงูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

**ุงููุฒุงูุง:**
- โ **ููุงู ูุงุญุฏ** - ุณูู ุงูุตูุงูุฉ
- โ **ูุนูู ูุฌููุน ุงููุตุงุฏุฑ:**
  - ุฑูุน ุตูุฑุฉ (OCR)
  - ูุณุฎ/ูุตู ูุต
  - ูุชุงุจุฉ ูุฏููุฉ
- โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก** - ูุง ูุนุทู ุงูุนูููุฉ
- โ **logging ูุงุถุญ** ูู console

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ุฃู ูุตุฏุฑ ูููุต                             โ
โ  (ุฑูุน ุตูุฑุฉ / ูุณุฎ ููุตู / ูุชุงุจุฉ ูุฏููุฉ)                       โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              text.create mutation                            โ
โ                                                              โ
โ  โจ STEP 1: cleanAndFormatText(text)                        โ
โ     โโ Gemini ููุฑุฃ ุงููุต                                     โ
โ     โโ Gemini ูุญูู ุงูุฃุฎุทุงุก                                  โ
โ     โโ Gemini ูุตูุญ ููููุณู                                   โ
โ     โโ ูุต ูุธูู โ                                           โ
โ                                                              โ
โ  STEP 2: ุญุณุงุจ ุนุฏุฏ ุงููููุงุช (cleanedText)                    โ
โ  STEP 3: ูุดู ุงูุชูุฑุงุฑ (cleanedText)                         โ
โ  STEP 4: ุงูุชูุณูู ุงููุชูุฏู (cleanedText)                      โ
โ  STEP 5: ุชูููุฏ ุงูุนููุงู (cleanedText)                        โ
โ  STEP 6: ุชูููุฏ ุงูุฃุณุฆูุฉ (cleanedText)                        โ
โ  STEP 7: ุญูุธ ูู DB (cleanedText)                           โ
โ  STEP 8: ุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช (cleanedText)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ุงูุชุญุงู ุจูุต ูุธูู ููููุณู โ                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุฃูุซูุฉ

### ูุซุงู 1: ูุต ูู OCR (ุตูุฑุฉ)

**ุงูุฅุฏุฎุงู:**
```
Wat moet mijn vader doen op een bedrijfsfeest a IA n t | Ee | Ek SE \ EN ยฃ 5 NA An "We Dl ON DE ED << WW 2 * + J EG EN ยฉ Ab bee ee! \ j > > + ยซ- fl Het bedrijf van mijn vaders
```

**ุจุนุฏ cleanAndFormatText:**
```
Wat moet mijn vader doen op een bedrijfsfeest?

Het bedrijf van mijn vader organiseert regelmatig evenementen voor werknemers.
```

---

### ูุซุงู 2: ูุต ููุณูุฎ ูุน ุฃุฎุทุงุก

**ุงูุฅุฏุฎุงู:**
```
nederland   is een mooi land.het heeft veel   steden zoals amsterdam,rotterdam en den haag
```

**ุจุนุฏ cleanAndFormatText:**
```
Nederland is een mooi land. Het heeft veel steden zoals Amsterdam, Rotterdam en Den Haag.
```

---

### ูุซุงู 3: ูุต ูุฏูู ุตุญูุญ

**ุงูุฅุฏุฎุงู:**
```
Nederland is een land in West-Europa. Het heeft een rijke geschiedenis en cultuur.
```

**ุจุนุฏ cleanAndFormatText:**
```
Nederland is een land in West-Europa. Het heeft een rijke geschiedenis en cultuur.
```
*(ูุง ุชุบููุฑ - ุงููุต ุตุญูุญ)*

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุฑูุน ุตูุฑุฉ:
```bash
1. ุงูุชุญ http://localhost:3000/create-exam
2. ุงุฑูุน ุตูุฑุฉ ุจูุต ููููุฏู (ุญุชู ูู ุจู ุฃุฎุทุงุก OCR)
3. ุงูุชุธุฑ ุงุณุชุฎุฑุงุฌ ุงููุต
4. ุชุญูู ูู console:
   [Text Creation] Cleaning and formatting text with Gemini AI...
   [Text Creation] Text cleaned successfully
5. ุฃูุดุฆ ุงูุชุญุงู
6. ุชุญูู ูู ุงููุต ูู ุงูุงูุชุญุงู - ูุฌุจ ุฃู ูููู ูุธูู!
```

### 2. ุงุฎุชุจุงุฑ ูุณุฎ/ูุตู:
```bash
1. ุงูุชุญ http://localhost:3000/create-exam
2. ุงูุณุฎ ูุต ุจู ุฃุฎุทุงุก ูุงูุตูู
3. ุงุถุบุท "Validate & Create Exam"
4. ุชุญูู ูู console logs
5. ุชุญูู ูู ุงููุต ูู ุงูุงูุชุญุงู
```

### 3. ุงุฎุชุจุงุฑ ูุชุงุจุฉ ูุฏููุฉ:
```bash
1. ุงูุชุญ http://localhost:3000/create-exam
2. ุงูุชุจ ูุต ูุฏููุงู (ุญุชู ูู ุจู ุฃุฎุทุงุก ุจุณูุทุฉ)
3. ุงุถุบุท "Validate & Create Exam"
4. ุชุญูู ูู ุงููุต ูู ุงูุงูุชุญุงู
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. `server/lib/gemini.ts`
- โจ ุฅุถุงูุฉ `cleanAndFormatText()` - ุฏุงูุฉ ููุญุฏุฉ ุฐููุฉ
- โ ุญุฐู `cleanOCRText()` - ูู ุชุนุฏ ูุทููุจุฉ

### 2. `server/lib/ocr.ts`
- โ ุญุฐู ุงูุชูุธูู ุงููุญูู ูู `extractTextFromImage()`
- โ OCR ุงูุขู ูุณุชุฎุฑุฌ ุงููุต ููุท (ุจุฏูู ุชูุธูู)

### 3. `server/routers.ts`
- โจ ุฅุถุงูุฉ ุฎุทูุฉ ุชูุธูู ูู ุจุฏุงูุฉ `text.create`
- โ ุงุณุชุฎุฏุงู `cleanedText` ูู ุฌููุน ุงูุนูููุงุช

---

## ๐ก ุงููุฒุงูุง

### 1. ุงูุจุณุงุทุฉ:
- โ **ุญู ูุงุญุฏ** ุจุฏูุงู ูู ุญููู ูุชุนุฏุฏุฉ
- โ **ููุงู ูุงุญุฏ** ููุตูุงูุฉ
- โ **ููุฏ ุฃูู** ูุฃูุถุญ

### 2. ุงูุฐูุงุก:
- โ **Gemini ููุฑุฑ** - ูุง regex ูุนูุฏุฉ
- โ **ูููู ุงูุณูุงู** - ูุง ูุบูุฑ ุงููุต ุงูุตุญูุญ
- โ **ูุชุนูู** - ูุชุญุณู ูุน ุงูููุช

### 3. ุงูุดููููุฉ:
- โ ูุนูู ูุน **ุฌููุน ุงููุตุงุฏุฑ**
- โ ูุตูุญ **ุฌููุน ุฃููุงุน ุงูุฃุฎุทุงุก**
- โ **ุขูู** - ูุง ูุนุทู ุงูุนูููุฉ

### 4. ุงูุฌูุฏุฉ:
- โ ูุตูุต **ูุธููุฉ ููููุณูุฉ**
- โ ุงูุชุญุงูุงุช **ุฐุงุช ุฌูุฏุฉ ุนุงููุฉ**
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู **ููุชุงุฒุฉ**

---

## โ๏ธ ููุงุญุธุงุช

### ุงูุฃุฏุงุก:
- โฑ๏ธ ูุถูู **5-10 ุซูุงูู** ููู ูุต (Gemini API)
- ๐ฐ ูุณุชููู **tokens** ูู Gemini
- โ **ูุณุชุญู** - ุฌูุฏุฉ ุฃูุถู ุจูุซูุฑ

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
- โ ุฅุฐุง ูุดู Geminiุ ูุณุชูุฑ ุจุงููุต ุงูุฃุตูู
- โ ูุง ูุนุทู ุฅูุดุงุก ุงูุงูุชุญุงู
- โ logging ูุงุถุญ ููุชุชุจุน

### ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ:
- ๐ก ุฅุถุงูุฉ cache ูููุตูุต ุงูููุธูุฉ
- ๐ก ุนุฑุถ diff (ูุจู/ุจุนุฏ) ูููุณุชุฎุฏู
- ๐ก ุฎูุงุฑ ูุชุนุทูู ุงูุชูุธูู

---

## ๐ฏ ุงูุฎูุงุตุฉ

โ **ุชู ุชูููุฐ ุญู ููุญุฏ ูุฐูู ูุชูุธูู ุงููุตูุต**

**ุงููุชูุฌุฉ:**
- ๐ **ุฌููุน ุงููุตูุต** (OCR / ูุณุฎ / ูุฏูู) ุชููุธู ุชููุงุฆูุงู
- ๐ **Gemini ููุฑุฑ** ูุง ูุญุชุงุฌ ุฅุตูุงุญ
- ๐ **ููุงู ูุงุญุฏ** - ุณูู ุงูุตูุงูุฉ
- ๐ **ุฌูุฏุฉ ุนุงููุฉ** ููุงูุชุญุงูุงุช

**ุฌุงูุฒ ููุงุฎุชุจุงุฑ! ๐**
