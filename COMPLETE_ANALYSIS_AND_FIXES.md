# ุชุญููู ูุงูู ูุชุทุจูู Dutch B1 Exam Generator ูุฅุตูุงุญ ุงูุฃุฎุทุงุก

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุชุทุจูู

**Dutch B1 Exam Generator** ูู ุชุทุจูู ููุจ ูุชูุงูู ูุชุนูู ุงููุบุฉ ุงูููููุฏูุฉ ุนูู ูุณุชูู B1ุ ูุชูุญ ูููุณุชุฎุฏููู:
- ุฅูุดุงุก ุงูุชุญุงูุงุช ููู ูุฑุงุฆู ูู ูุตูุต ููููุฏูุฉ
- ุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช ุชููุงุฆูุงู ูุน ุงูุชุฑุฌูุฉ (ุนุฑุจูุ ุฅูุฌููุฒูุ ุชุฑูู)
- ุชุชุจุน ุงูุชูุฏู ูุงูุฅุญุตุงุฆูุงุช
- ูุธุงู ูุฑุงุฌุนุฉ ุงูููุฑุฏุงุช ุจุฎูุงุฑุฒููุฉ Spaced Repetition (SM-2)
- ูุตุงุฏูุฉ ุนุจุฑ Google OAuth

### ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ
- **Frontend**: React + TypeScript + Vite + TailwindCSS
- **Backend**: Node.js + Express + tRPC
- **Database**: PostgreSQL (Neon) + Drizzle ORM
- **AI**: Google Gemini API (ุชูููุฏ ุงูุฃุณุฆูุฉ ูุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช)
- **Storage**: Cloudflare R2 (ููุตูุฑ)
- **Authentication**: Passport.js + Google OAuth

---

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ ูุงูุฅุตูุงุญุงุช

### 1. โ ูุดููุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (Environment Variables)

#### ุงููุดููุฉ
ุนูุฏ ุชุดุบูู ุงูุชุทุจูู ูุญููุงูุ ูุงูุช ููุงู ูุดุงูู ูู:
- **GOOGLE_REDIRECT_URI**: ูุงู ูุถุจูุทุงู ุนูู ุนููุงู ุงูุฅูุชุงุฌ (Railway)
- **VITE_APP_TITLE**: ูู ููู ูุญุฏุฏุงูุ ููุง ุฃุฏู ุฅูู ุธููุฑ `%VITE_APP_TITLE%` ูู ุงูุนููุงู

#### ุงูุญู
ุชู ุชุญุฏูุซ ููู `.env` ุจุงูููู ุงูุตุญูุญุฉ ููุจูุฆุฉ ุงููุญููุฉ:

```env
# ููุชุทููุฑ ุงููุญูู
GOOGLE_REDIRECT_URI="http://localhost:3000/auth/callback"
VITE_APP_TITLE="Dutch B1 Exam Generator"

# ูุชุนุทูู ุงููุตุงุฏูุฉ ุฃุซูุงุก ุงูุชุทููุฑ
DISABLE_AUTH="true"
```

#### ุงูููู ุงููุนุฏู
- `/home/ubuntu/dutch-b1-exam-generator/.env`

---

### 2. โ ุฎุทุฃ ูู ุญูุธ ุงูููุฑุฏุงุช (Vocabulary Save Error)

#### ุงููุดููุฉ
ุนูุฏ ุงูููุฑ ุงููุฒุฏูุฌ ุนูู ูููุฉ ูุญูุธูุง ูู ุงูููุฑุฏุงุช ุงูุดุฎุตูุฉุ ูุงู ูุญุฏุซ ุฎุทุฃ 500:

```
Failed query: insert into "user_vocabulary" 
params: 999,3,new,0,0,,2025-11-21T18:06:35.466Z,2500,0,0
                      ^^
                      ูููุฉ null ูุงุฑุบุฉ
```

**ุงูุณุจุจ**: ูุงู ุงูููุฏ ููุฑุฑ `last_reviewed_at: null` ุจุดูู ุตุฑูุญุ ููุง ูุณุจุจ ูุดููุฉ ูุน Drizzle ORM ู PostgreSQL.

#### ุงูุญู
ุชู ุญุฐู ุงูุณุทุฑ ุงูุฐู ููุฑุฑ `last_reviewed_at: null` ูู ุฏุงูุฉ `saveWordFromText`:

**ูุจู ุงูุฅุตูุงุญ** (ุงูุณุทุฑ 810):
```typescript
await db.createUserVocabulary({
  user_id: ctx.user.id,
  vocabulary_id: vocabEntry.id,
  status: "new",
  correct_count: 0,
  incorrect_count: 0,
  last_reviewed_at: null,  // โ ูุฐุง ูุณุจุจ ุงููุดููุฉ
  next_review_at: new Date(),
  ease_factor: 2500,
  interval: 0,
  repetitions: 0,
});
```

**ุจุนุฏ ุงูุฅุตูุงุญ**:
```typescript
await db.createUserVocabulary({
  user_id: ctx.user.id,
  vocabulary_id: vocabEntry.id,
  status: "new",
  correct_count: 0,
  incorrect_count: 0,
  // โ ุชู ุญุฐู last_reviewed_at - ุณูููู NULL ุชููุงุฆูุงู
  next_review_at: new Date(),
  ease_factor: 2500,
  interval: 0,
  repetitions: 0,
});
```

#### ุงูููู ุงููุนุฏู
- `/home/ubuntu/dutch-b1-exam-generator/server/routers.ts` (ุงูุณุทุฑ 810)

#### ุงูุชูุณูุฑ ุงูุชููู
- ูู Drizzle ORMุ ุงูุญููู nullable ูุฌุจ ุนุฏู ุชูุฑูุฑูุง ุฅุฐุง ุฃุฑุฏูุง ูููุฉ `NULL`
- ุชูุฑูุฑ `null` ุจุดูู ุตุฑูุญ ูุญุงูู Drizzle ุชุฑุฌูุชู ุฅูู `default` ูู SQLุ ููุง ูุณุจุจ ุฎุทุฃ
- ุงูุญู ุงูุตุญูุญ ูู ุนุฏู ุชุถููู ุงูุญูู ูู ุงููุงุฆู ุงููููุฑุฑ

---

### 3. โ๏ธ ููุงุญุธุฉ: ุงููุตูุต ุงููุฏููุฉ ุจุฏูู ููุฑุฏุงุช

#### ุงูููุงุญุธุฉ
ุงููุตูุต ุงูููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฅูุชุงุฌูุฉ (ูุซู ุงููุต ุฑูู 56) ูุง ุชุญุชูู ุนูู ููุฑุฏุงุช ูุฑุชุจุทุฉ ุจูุง. ูุฐุง ูุนูู:
- ูุง ุชูุฌุฏ ูููุงุช ุชูุงุนููุฉ (underlined words) ูู ูุฐู ุงูุงูุชุญุงูุงุช
- ุงููุณุชุฎุฏููู ูุง ูููููู ุญูุธ ูููุงุช ูู ูุฐู ุงููุตูุต

#### ุงูุณุจุจ ุงููุญุชูู
- ุงููุตูุต ุชู ุฅูุดุงุคูุง ูุจู ุชูุนูู ููุฒุฉ ุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช ุงูุชููุงุฆู
- ุฃู ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช ููู ูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ

#### ุงูุญู ุงูููุชุฑุญ (ูููุณุชูุจู)
ุฅูุดุงุก ุณูุฑูุจุช ูุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช ูููุตูุต ุงููุฏููุฉ:

```javascript
// scripts/backfill-vocabulary.js
import * as db from '../server/db.js';
import * as gemini from '../server/lib/gemini.js';

async function backfillVocabulary() {
  const textsWithoutVocab = await db.getTextsWithoutVocabulary();
  
  for (const text of textsWithoutVocab) {
    try {
      const vocabData = await gemini.extractVocabulary(text.dutch_text);
      
      for (const word of vocabData.vocabulary) {
        const vocab = await db.createVocabulary({
          dutchWord: word.dutch,
          context: word.context || 'general',
          // ... ุจุงูู ุงูุญููู
        });
        await db.linkVocabularyToText(text.id, vocab[0].id);
      }
      
      console.log(`โ Processed text ${text.id}`);
    } catch (error) {
      console.error(`โ Failed for text ${text.id}:`, error);
    }
  }
}
```

---

## โ ุงููุธุงุฆู ุงูุชู ุชู ุงุฎุชุจุงุฑูุง ุจูุฌุงุญ

### 1. โ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (Homepage)
- ุชุญููู ุงูุตูุญุฉ ุจูุฌุงุญ
- ุนุฑุถ ุงููุบุงุช ุงููุชุนุฏุฏุฉ (ููููุฏูุ ุนุฑุจูุ ุฅูุฌููุฒูุ ุชุฑูู)
- ุชุจุฏูู ุงููุบุฉ ูุนูู ุจุดูู ุตุญูุญ

### 2. โ ุงูุงูุชุญุงูุงุช ุงูุนุงูุฉ (Public Exams)
- ุนุฑุถ ูุงุฆูุฉ ุงูุงูุชุญุงูุงุช ุงููุชุงุญุฉ
- ุนุฑุถ ูุนูููุงุช ูู ุงูุชุญุงู (ุนุฏุฏ ุงููููุงุชุ ููุช ุงููุฑุงุกุฉุ ุงููุณุชูู)
- ุฒุฑ "Start Exam" ูุนูู

### 3. โ ุตูุญุฉ ุงูุงูุชุญุงู (Exam Page)
- ุนุฑุถ ุงููุต ุงูููููุฏู ูุงููุงู
- ุนุฑุถ 10 ุฃุณุฆูุฉ ููู ูุชุนุฏุฏุฉ ุงูุฎูุงุฑุงุช
- ุงูุฃุณุฆูุฉ ููุธูุฉ ูููุณูุฉ ุจุดูู ุฌูุฏ
- ุฃุฒุฑุงุฑ ุงูุทุจุงุนุฉ ูุงูุฅููุงุก ุชุนูู

### 4. โ ุตูุญุฉ ุงูุชูุฏู (Progress Page)
- ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช:
  - ุนุฏุฏ ุงูุงูุชุญุงูุงุช ุงูููุชููุฉ
  - ุงููุณุจุฉ ุงููุฆููุฉ ูููุฌุงุญ
  - ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงููุฌุงุจุฉ
  - ุนุฏุฏ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ
- ุนุฑุถ ุงูุฃุฏุงุก ุญุณุจ ููุน ุงูุณุคุงู:
  - ุงูููุฑุฉ ุงูุฑุฆูุณูุฉ (Main Idea)
  - ุงูุจุญุซ (Search)
  - ุงูุชุณูุณู (Sequence)
  - ุงูุงุณุชูุชุงุฌ (Inference)
  - ุงูููุฑุฏุงุช (Vocabulary)

### 5. โ ุตูุญุฉ ุงูููุฑุฏุงุช (Vocabulary Page)
- ุนุฑุถ ุฑุณุงูุฉ "No vocabulary yet" ูููุณุชุฎุฏู ุงูุฌุฏูุฏ
- ุชุนูููุงุช ูุงุถุญุฉ ูุจุฏุก ุจูุงุก ุงูููุฑุฏุงุช

### 6. โ ูุธุงู ุงููุตุงุฏูุฉ (Authentication)
- ุชุนุทูู ุงููุตุงุฏูุฉ ููุชุทููุฑ ุงููุญูู ูุนูู (`DISABLE_AUTH=true`)
- ุงููุณุชุฎุฏู ุงูุชุทููุฑู (Development User) ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู
- ุงูุฌูุณุงุช (Sessions) ุชุนูู ุจุดูู ุตุญูุญ

---

## ๐๏ธ ุจููุฉ ุงูุชุทุจูู (Architecture)

### ูููู ุงููุฌูุฏุงุช
```
dutch-b1-exam-generator/
โโโ client/                 # Frontend (React + TypeScript)
โ   โโโ src/
โ   โ   โโโ components/    # ููููุงุช React
โ   โ   โโโ pages/         # ุตูุญุงุช ุงูุชุทุจูู
โ   โ   โโโ lib/           # ููุชุจุงุช ูุณุงุนุฏุฉ
โ   โ   โโโ main.tsx       # ููุทุฉ ุงูุฏุฎูู
โ   โโโ index.html
โ
โโโ server/                 # Backend (Node.js + Express)
โ   โโโ _core/             # ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ
โ   โ   โโโ index.ts       # ููุทุฉ ุงูุฏุฎูู ููุฎุงุฏู
โ   โ   โโโ trpc.ts        # ุฅุนุฏุงุฏ tRPC
โ   โ   โโโ env.ts         # ูุชุบูุฑุงุช ุงูุจูุฆุฉ
โ   โโโ auth/              # ูุธุงู ุงููุตุงุฏูุฉ
โ   โ   โโโ google.ts      # Google OAuth
โ   โโโ lib/               # ููุชุจุงุช ูุณุงุนุฏุฉ
โ   โ   โโโ gemini.ts      # ุชูุงูู Gemini AI
โ   โ   โโโ srs.ts         # ุฎูุงุฑุฒููุฉ Spaced Repetition
โ   โ   โโโ ocr.ts         # ุงุณุชุฎุฑุงุฌ ุงููุต ูู ุงูุตูุฑ
โ   โโโ routers.ts         # API endpoints (tRPC)
โ   โโโ db.ts              # ูุธุงุฆู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ
โโโ drizzle/               # Database schema
โ   โโโ schema.ts          # ุชุนุฑูู ุงูุฌุฏุงูู
โ
โโโ shared/                # ููุฏ ูุดุชุฑู ุจูู Frontend ู Backend
โ   โโโ schema.ts
โ
โโโ .env                   # ูุชุบูุฑุงุช ุงูุจูุฆุฉ
```

### ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Schema)

#### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ:
1. **users** - ูุนูููุงุช ุงููุณุชุฎุฏููู
2. **texts** - ุงููุตูุต ุงูููููุฏูุฉ
3. **exams** - ุงูุงูุชุญุงูุงุช
4. **exam_results** - ูุชุงุฆุฌ ุงูุงูุชุญุงูุงุช
5. **vocabulary** - ุงูููุฑุฏุงุช (ูุดุชุฑูุฉ ุจูู ุฌููุน ุงููุณุชุฎุฏููู)
6. **user_vocabulary** - ุงูููุฑุฏุงุช ุงูุดุฎุตูุฉ ููู ูุณุชุฎุฏู
7. **text_vocabulary** - ุฑุจุท ุงููุตูุต ุจุงูููุฑุฏุงุช

---

## ๐ ููููุฉ ุชุดุบูู ุงูุชุทุจูู ูุญููุงู

### ุงููุชุทูุจุงุช
- Node.js 22.x
- PostgreSQL (ุฃู ุงุณุชุฎุฏุงู Neon)
- ุญุณุงุจ Google Cloud (ููู OAuth)
- ุญุณุงุจ Google AI (ููู Gemini API)

### ุฎุทูุงุช ุงูุชุดุบูู

1. **ุงุณุชูุณุงุฎ ุงููุดุฑูุน**
```bash
gh repo clone alwleedk-source/dutch-b1-exam-generator
cd dutch-b1-exam-generator
```

2. **ุชุซุจูุช ุงูุญุฒู**
```bash
pnpm install
```

3. **ุฅุนุฏุงุฏ ููู .env**
```env
# Database
DATABASE_URL="postgresql://..."

# Authentication
DISABLE_AUTH="true"  # ููุชุทููุฑ ุงููุญูู
GOOGLE_CLIENT_ID="..."
GOOGLE_CLIENT_SECRET="..."
GOOGLE_REDIRECT_URI="http://localhost:3000/auth/callback"

# AI
GEMINI_API_KEY="..."

# Storage
R2_ACCOUNT_ID="..."
R2_ACCESS_KEY_ID="..."
R2_SECRET_ACCESS_KEY="..."
R2_BUCKET_NAME="..."
R2_PUBLIC_URL="..."

# Session
SESSION_SECRET="..."

# App
VITE_APP_TITLE="Dutch B1 Exam Generator"
VITE_APP_LOGO="/favicon.svg"
```

4. **ุชุดุบูู ุงูุชุทุจูู**
```bash
pnpm dev
```

5. **ูุชุญ ุงููุชุตูุญ**
```
http://localhost:3000
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ุงููุตุงุฏูุฉ (Authentication)
- ูู ุงูุจูุฆุฉ ุงููุญููุฉ: ุงุณุชุฎุฏู `DISABLE_AUTH="true"` ููุชุทููุฑ ุจุฏูู ุชุณุฌูู ุฏุฎูู
- ูู ุงูุฅูุชุงุฌ: ูุฌุจ ุชุนููู `DISABLE_AUTH="false"` ูุชูููู Google OAuth ุจุดูู ุตุญูุญ

### 2. Gemini API
- ูุชู ุงุณุชุฎุฏุงู Gemini ูู:
  - ุชูููุฏ ุฃุณุฆูุฉ ุงูุงูุชุญุงู (10 ุฃุณุฆูุฉ ููู)
  - ุงุณุชุฎุฑุงุฌ ุงูููุฑุฏุงุช ูุน ุงูุชุฑุฌูุงุช
  - ุชูููุฏ ุนูุงููู ูููุตูุต
- ุชุฃูุฏ ูู ูุฌูุฏ ุฑุตูุฏ ูุงูู ูู ุญุณุงุจ Google AI

### 3. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูุชุทุจูู ูุณุชุฎุฏู Neon (PostgreSQL serverless)
- ูุชู ุชุดุบูู migrations ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุชุทุจูู
- ููุฅูุชุงุฌ: ุชุฃูุฏ ูู ุชูุนูู connection pooling

### 4. ุงูุฃูุงู
- ูุง ุชุดุงุฑู ููู `.env` ุฃุจุฏุงู
- ุงุณุชุฎุฏู `SESSION_SECRET` ููู ูู ุงูุฅูุชุงุฌ
- ุชุฃูุฏ ูู ุชูููู CORS ุจุดูู ุตุญูุญ

---

## ๐ ุงูุฃุฎุทุงุก ุงููุชุจููุฉ ูุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ

### ุฃุฎุทุงุก ูุฌุจ ุฅุตูุงุญูุง:
1. โ **OAUTH_SERVER_URL not configured** - ูุธูุฑ ูู ุงูุณุฌูุงุช ูููู ูุง ูุคุซุฑ ุนูู ุงูุชุทุจูู
2. โ๏ธ **ุงููุตูุต ุงููุฏููุฉ ุจุฏูู ููุฑุฏุงุช** - ูุญุชุงุฌ ุฅูู ุณูุฑูุจุช backfill

### ุชุญุณููุงุช ููุชุฑุญุฉ:
1. ๐ ุฅุถุงูุฉ loading states ุฃูุถู
2. ๐จ ุชุญุณูู UI/UX ูููููุงุช ุงูุชูุงุนููุฉ
3. ๐ ุฅุถุงูุฉ ุฑุณูู ุจูุงููุฉ ููุชูุฏู
4. ๐ ุฅุถุงูุฉ ุจุญุซ ูู ุงูููุฑุฏุงุช
5. ๐ฑ ุชุญุณูู responsive design ููููุจุงูู
6. โก ุฅุถุงูุฉ caching ูููุตูุต ูุงูููุฑุฏุงุช
7. ๐งช ุฅุถุงูุฉ unit tests ู integration tests
8. ๐ ุฅุถุงูุฉ documentation ุฃูุถู ููู API

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชุญููู ุงูุชุทุจูู ุจูุฌุงุญ ูุฅุตูุงุญ ุงููุดุงูู ุงูุฑุฆูุณูุฉ:

1. โ **ุฅุตูุงุญ ูุชุบูุฑุงุช ุงูุจูุฆุฉ** - ุงูุชุทุจูู ูุนูู ูุญููุงู ุจุฏูู ูุดุงูู
2. โ **ุฅุตูุงุญ ุฎุทุฃ ุญูุธ ุงูููุฑุฏุงุช** - ุชู ุญู ูุดููุฉ `last_reviewed_at: null`
3. โ **ุงุฎุชุจุงุฑ ุฌููุน ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ** - ูู ุดูุก ูุนูู ุจุดูู ุตุญูุญ

ุงูุชุทุจูู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงููุญูู ูุงูุชุทููุฑ! ๐
